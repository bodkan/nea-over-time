This repository contains source code and Jupyter notebooks for data processing,
simulations and analyses used in [this](https://www.biorxiv.org/content/early/2018/07/04/362566) paper.

To reproduce everything from scratch, you'll need to install all dependencies
listed bellow.

Full disclosure: I've been very lucky to have amazing computational
resources at my disposal (60 core machines with 1 TB RAM and a cluster with
hundreds of nodes) and I often used them to their [full potential](https://twitter.com/fleventy5/status/801480069034164224).
Unless you have similar resources, then it's not trivial to truly reproduce
everything from scratch. At the very least, it will take much longer to run
all the simulations if you cannot parallelize them effectively. I will do my best
to figure out a way to share the results of all simulations (a couple of hundreds
of gigabytes), so it's possible to reproduce the final results and plots
without re-running the whole simulation pipeline.

## Python

I used Python version 3.6.5 and the following Python modules:

```
pip install numpy pandas msprime pybedtools jupyter
```

## R

I used R version 3.4.3.

Packages from CRAN:
```
install.packages(c("broom", "forcats", "future", "ggbeeswarm", "ggrepel",
                   "here", "latex2exp", "magrittr", "Metrics", "modelr",
                   "purrr", "stringr", "tidyverse"))
```

Packages from Bioconductor:
```
install.packages("BiocManager")
BiocManager::install(c("biomaRt", "VariantAnnotation", "BSgenome.Hsapiens.UCSC.hg19",
                       "GenomicRanges",  "rtracklayer"))
```

Packages from GitHub:
```
install.packages("devtools")
devtools::install_github("thomasp85/patchwork")
devtools::install_github("bodkan/bdkn")
devtools::install_github("bodkan/slimr", ref = "v0.1")
devtools::install_github("bodkan/admixr", ref = "v0.3")
```

To be able to run Jupyter notebooks that contain all my analses and figures,
you will also need to install [IRkernel](https://irkernel.github.io).

## SLiM

I used SLiM v2.6. Be aware that SLiM introduced some backwards incompatible
changes since its 2.0 release, so make sure to use exactly version 2.6.

## HOWTO

In principle, different notebooks in the `notebooks/` directory use different data
generated by "pipeline scripts" in the root of the repository (`00_...sh`, `01_...sh`, etc.).
However, there's no strict sequential order of executing everything. In fact, I ran those
scripts mostly by pieces, adding additional commands as the project developed, and analyzed new
data as they were being generated.
